# Creating Your First Service

## Introduction

Platform is a collection of microservices that provide APIs to consuming applications.  To define it further, Platform is primarily a data access layer - when some application needs to store, retrieve, or sometimes process data, it has to interface with Platform to accomplish this.  This might sound like nonsense if you're unfamiliar, but don't worry - this tutorial will guide you through everything you need to know for Platform.

## Glossary

Below are terms that we'll be using throughout the tutorial.  These are crucial to understanding what Platform is, how it works, and the mindset needed when it comes to planning and implementation.

| Term                       | Definition                                                                                                                                                                                                                                                                                                                                                                                                              |
|:---------------------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Audience                   | Every Token has a set of permissions attached to it.  These permissions are linked to specific projects.  For example, a player's token might be allowed to interact with player-service, but disallowed from interacting with dynamic config, since that's purely an admin-only project.                                                                                                                               |
| Client                     | The application that consumes a web service.  This could be a phone app / game, an internal website like the publishing app, or even a tool like Postman.                                                                                                                                                                                                                                                               |
| CI / Environment Variables | When a server starts up, Gitlab passes along certain variables such as connection strings to the application.  CI variables should always be limited to only what's strictly necessary for startup -or- sensitive information.  For everything else, use **Dynamic Config.**  Since we can't use Gitlab CI variables locally, we can populate a file `environment.json` with the same values.                           |
| Collection                 | In MongoDB, you store "documents" in "collections".  If you're familiar with SQL or other RDBMS, think of this like a table, and a document is a row.  Within Platform, every Collection is tied to a **specific Model** to enforce a uniform data structure.                                                                                                                                                           |
| Controller                 | A class that handles API routing for requests.  Controllers contain most of the logic for requests and send data back to the client.                                                                                                                                                                                                                                                                                    |
| Endpoint                   | A partial or full web address to a resource.  Examples include `/player/login`, `/chat/message`, or `/telemetry/send`.  When discussed within Platform, an endpoint refers to the specific C# method found in a controller that processes a request sent to this address.                                                                                                                                               |
| Filter                     | C# feature only.  Filters give us the ability to execute snippets of code before or after normal Request processing, and let us keep our code extremely clean.  As an example, all of our authorization is handled automatically by a filter - there's practically no code needed on a developer's part to verify incoming requests.                                                                                    |
| Health Check               | When deployed, Platform projects are managed by a tool named Kubernetes (K8S).  K8S will ping every server once per minute to make sure the server is still responsive.  This is called a "Health Check", and servers should return basic service information in this response.  Health Check endpoints are automatically added by platform-common, but you can add information to them (not covered in this tutorial). |
| HTTP Method                | Indicates the desired action a server should take with the data being sent.  The most common examples in Platform are GET, PATCH, and POST.                                                                                                                                                                                                                                                                             |
| JWT / Token                | A JSON Web Token.  This is an encrypted token issued by one of our servers.  It can be decrypted to guarantee clients are who they say they are, as well as contain relevant permissions.                                                                                                                                                                                                                               |
| MINQ                       | Mongo Integrated Query.  This is a proprietary wrapper for Mongo's driver.  MINQ provides us with more maintainable and much more readable code than what the default library gives us.  See the separate [readme](../MINQ.md) fo more information.                                                                                                                                                                     |
| Model                      | A code representation of data.  If the model represents a MongoDB object, it should have both database and friendly keys for JSON serialization.  As a rule of thumb, models should only contain properties and validation logic.                                                                                                                                                                                       |
| Project                    | All of the code that makes up a given Platform feature.  Every project has its own repo, and is typically named `{feature}-service`.                                                                                                                                                                                                                                                                                    |
| Request                    | The incoming message from the client that's asking the service to do something.  Requests should always be JSON.                                                                                                                                                                                                                                                                                                        |
| Response                   | The outgoing message to the client containing relevant data.  Responses should always be JSON.                                                                                                                                                                                                                                                                                                                          |
| Route                      | The relative URL path a client uses to access the API.  Example: `/chat/messages/send`                                                                                                                                                                                                                                                                                                                                  |
| Status Code                | All Requests will return a 3-digit status code.  While everyone is familiar with HTTP 404, there are a slew of them that are important.  Each carries a specific meaning.  The most common codes in Platform are 200, 204, 400, and 403.                                                                                                                                                                                |
| Service                    | A static class acting as an interface between a Controller and a data layer such as MongoDB. For Mongo specifically, every collection should have a corresponding Service. <br /><br />Note that while Projects tend to include "service" in their name, within the context of Platform code, "service" specifically refers to the classes responsible for data I/O with the database.                                  |
| Token / JWT                | An encoded string that contains information Platform needs to identify a player, along with any permissions the account holds.                                                                                                                                                                                                                                                                                          |

## Prerequisites

1. Postman is installed.
2. MongoDB is installed.
3. MongoDB Compass is installed.
4. .NET 8.0+ is installed.
5. You have set up a Rider solution as per the **Getting Started** section of the [README](../README.md) file.
6. Your NuGet is configured to use gitlab as a supplemental source as per the **Adding the Library** section of the [README](../README.md) file.

**Note:** Platform engineers traditionally work off of macOS machines.  Consequently, if you use Windows, you may need to troubleshoot some unexpected issues, though they shouldn't be significant.  .NET Core applications are cross-platform, so it's just a matter of getting them to run.

This tutorial also assumes you know how to import missing references.  At various points, adding code will require you to do this.  You may have syntax errors if you're missing references - and while Rider usually prompts you for action on these, this is a very common programming practice that will not be mentioned when needed.

Another assumption is that you're familiar with C# syntax terminology.  If you're not used to talking C#, you may need to look terms up as you go, but the tutorial should still be accessible as required code is generally provided in code blocks.

At various points, this tutorial will prompt you to do "homework" or "extra credit" - these are exercises intended to get you to use what you've learned and get some practice in yourself without just blindly pasting code blocks around.  You'll get more out of this tutorial if you take your time to play with the system you're building - and these exercises offer points for reinforcement.

With this out of the way, let's move on to Step 2: [Project Setup](02%20-%20Project%20Setup.md).